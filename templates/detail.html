{% extends "base.html" %}
{% block title %}Detalhes ‚Ä¢ {{ ship.title }}{% endblock %}

{% block content %}
<h1>Checklist: {{ ship.title }}</h1>
<p class="muted">
  N√∫mero: {{ ship.number or '‚Äî' }} ‚Ä¢
  Enviado: {{ ship.sent_at|dt }} ‚Ä¢
  Visualizado: {{ ship.viewed_at|dt }} ‚Ä¢
  Recebido: {{ ship.received_at|dt }}<br>
  Respons√°vel: {{ ship.responsible_email or '‚Äî' }}
</p>

{% if gallery and gallery|length > 0 %}
  <h3>Imagens anexadas</h3>
  <div style="margin:8px 0 16px; display:flex; gap:10px; flex-wrap:wrap">
    {% for gimg in gallery %}
      <a href="{{ url_for('uploaded_file', filename=gimg.filename) }}" target="_blank" rel="noopener" title="ver anexo">
        <img src="{{ url_for('uploaded_file', filename=gimg.filename) }}"
             alt="anexo" style="width:110px;height:85px;object-fit:cover;border:1px solid #e2e8f0;border-radius:6px;">
      </a>
    {% endfor %}
  </div>
{% endif %}

<p>
  <a class="btn secondary" href="{{ ship.open_url() }}">Abrir checklist p√∫blico</a>
</p>

<h2>Itens</h2>
<table>
  <thead>
    <tr>
      <th style="width:36px">#</th>
      <th>Item</th>
      <th style="width:25%">Visto</th>
      <th style="width:25%">Confirmado</th>
    </tr>
  </thead>
  <tbody>
    {% for it in items %}
    <tr>
      <td class="muted">{{ loop.index }}</td>
      <td>{{ it.label }}</td>
      <td class="muted">
        {% if it.viewed_at %}
          {{ it.viewed_at|dt }}<br><small>{{ it.viewed_by }}</small>
        {% else %}
          <span class="muted">Ainda n√£o visto</span>
        {% endif %}
      </td>
      <td class="muted">
        {% if it.confirmed_at %}
          ‚úîÔ∏è {{ it.confirmed_at|dt }}<br><small>{{ it.confirmed_by }}</small>
        {% else %}
          üïì Aguardando confirma√ß√£o
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h2 style="margin-top:22px">Timeline de eventos</h2>
<table>
  <thead>
    <tr>
      <th style="width:200px">Quando</th>
      <th style="width:260px">Quem</th>
      <th>O qu√™</th>
      <th class="muted">IP / Agent</th>
    </tr>
  </thead>
  <tbody>
    {% for ev in events %}
    <tr>
      <td>{{ ev.ts|dt }}</td>
      <td class="muted">{{ ev.actor or '‚Äî' }}</td>
      <td><strong>{{ ev.type|evento_label }}</strong></td>
      <td class="muted"><small>{{ ev.ip or '-' }} ‚Ä¢ {{ ev.user_agent or '-' }}</small></td>
    </tr>
    {% endfor %}
    {% if not events %}
    <tr><td colspan="4" class="muted">Sem eventos ainda.</td></tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}
