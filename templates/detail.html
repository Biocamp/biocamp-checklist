{% extends "base.html" %}
{% block title %}Detalhes ‚Ä¢ {{ ship.title }}{% endblock %}
{% block content %}
<h1>Checklist: {{ ship.title }}</h1>
<p class="muted">
  N√∫mero: {{ ship.number or '‚Äî' }} ‚Ä¢
  Enviado: {{ ship.sent_at|dt }} ‚Ä¢
  Visualizado: {{ ship.viewed_at|dt }} ‚Ä¢
  Recebido: {{ ship.received_at|dt }}<br>
  Respons√°vel: {{ ship.responsible_email or '‚Äî' }}
</p>
<p><a class="btn secondary" href="{{ ship.open_url() }}">Abrir checklist p√∫blico</a></p>

<h2>Itens</h2>
<table>
  <thead>
    <tr>
      <th style="width:36px">#</th>
      <th>Item</th>
      <th style="width:24%">Imagem</th>
      <th style="width:22%">Visualizado</th>
      <th style="width:22%">Confirmado</th>
    </tr>
  </thead>
  <tbody>
    {% for it in items %}
    <tr>
      <td class="muted">{{ loop.index }}</td>
      <td>{{ it.label }}</td>
      <td>
        {% if it.image_path %}
          <img src="{{ url_for('static', filename=it.image_path) }}" alt="imagem" style="max-width:140px;border-radius:8px;display:block;margin-bottom:6px">
          <form method="post" action="{{ url_for('remove_item_image', ship_id=ship.id, item_id=it.id) }}">
            <button class="btn secondary" type="submit">Remover imagem</button>
          </form>
        {% else %}
          <form method="post" enctype="multipart/form-data" action="{{ url_for('upload_item_image', ship_id=ship.id, item_id=it.id) }}">
            <input type="file" name="image" accept="image/*" required>
            <button class="btn" type="submit">Anexar</button>
          </form>
          <div class="muted" style="font-size:12px;margin-top:6px">png, jpg, jpeg, webp, gif ‚Ä¢ at√© 8MB</div>
        {% endif %}
      </td>
      <td class="muted">
        {% if it.viewed_at %}üëÅÔ∏è {{ it.viewed_at|dt }}<br><small>{{ it.viewed_by }}</small>{% else %}‚Äî{% endif %}
      </td>
      <td class="muted">
        {% if it.confirmed_at %}‚úÖ {{ it.confirmed_at|dt }}<br><small>{{ it.confirmed_by }}</small>{% else %}‚è≥ Pendente{% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h2 style="margin-top:22px">Timeline de eventos</h2>
<table>
  <thead>
    <tr>
      <th style="width:200px">Quando</th>
      <th style="width:260px">Quem</th>
      <th>Tipo</th>
      <th class="muted">IP / Agent</th>
    </tr>
  </thead>
  <tbody>
    {% for ev in events %}
    <tr>
      <td>{{ ev.ts|dt }}</td>
      <td class="muted">{{ ev.actor or '‚Äî' }}</td>
      <td><strong>{{ ev.type }}</strong></td>
      <td class="muted"><small>{{ ev.ip or '-' }} ‚Ä¢ {{ ev.user_agent or '-' }}</small></td>
    </tr>
    {% endfor %}
    {% if not events %}
    <tr><td colspan="4" class="muted">Sem eventos ainda.</td></tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}
