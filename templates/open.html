{% extends "base.html" %}
{% block title %}Valida√ß√£o ‚Ä¢ {{ ship.title }}{% endblock %}
{% block content %}
<h1>Valida√ß√£o do Checklist: {{ ship.title }}</h1>
<p class="muted">
  {% if g.viewer_email %}
    Usu√°rio: <strong>{{ g.viewer_name or 'Usu√°rio' }} &lt;{{ g.viewer_email }}&gt;</strong>
  {% else %}
    Acesso como <strong>Convidado</strong>.
  {% endif %}
</p>

{% if not can_edit and ship.responsible_email %}
  <div class="muted" style="background:#f1f5f9;border:1px solid #e2e8f0;padding:10px 12px;border-radius:8px;margin-bottom:14px">
    Visualiza√ß√£o apenas. <strong>Somente o respons√°vel ({{ ship.responsible_email }})</strong> pode confirmar.
  </div>
{% endif %}

<form method="post" action="{{ url_for('open_public', token=ship.token) }}">
  <table>
    <thead>
      <tr>
        <th style="width:80px">Confirmar</th>
        <th>Item</th>
        <th style="width:40%">Status</th>
        <th style="width:160px">A√ß√µes</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>
          {% if can_edit and not it.confirmed_at %}
            <input type="checkbox" name="items" value="{{ it.id }}">
          {% else %}
            <input type="checkbox" disabled>
          {% endif %}
        </td>
        <td>{{ it.label }}</td>
        <td class="muted">
          {% if it.viewed_at %}
            üëÅÔ∏è Visualizado por {{ it.viewed_by or '‚Äî' }} em {{ it.viewed_at|dt }}
          {% else %}
            N√£o visualizado
          {% endif %}<br>
          {% if it.confirmed_at %}
            ‚úÖ Confirmado por <strong>{{ it.confirmed_by }}</strong> em {{ it.confirmed_at|dt }}
          {% else %}
            ‚è≥ Pendente
          {% endif %}
        </td>
        <td>
          {% if it.confirmed_at %}
            <span class="muted">‚Äî</span>
          {% else %}
            <button class="btn" style="background:#22c55e" type="submit" name="items" value="{{ it.id }}" {% if not can_edit %}disabled{% endif %}>
              Confirmar
            </button>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div style="display:flex;gap:12px;margin-top:16px">
    <button class="btn" style="background:#22c55e" type="submit" name="bulk" value="selected" {% if not can_edit %}disabled{% endif %}>
      Confirmar selecionados
    </button>
    <button class="btn" type="submit" name="confirm_all" value="1" {% if not can_edit %}disabled{% endif %}>
      Confirmar todos
    </button>
  </div>
</form>
{% endblock %}
